# 一、概念结构设计

首先我们powerdesigner中设计数据库的概念模型，针对我们要设计的教务管理系统的具体需求，构建了八个数据表

- 院系
- 专业
- 班级
- 学生
- 教师
- 课程
- 学生选课
- 课程班级

对于这些数据表之间的关系

存在如下关系：

学生————n_1————班级

班级————n_1————专业

专业————n_1————院系

教师————n_1————院系

教师————1_n————课程班级

课程————1_n————课程班级

学生————1_n————学生选课

学生选课————1_n————课程班级

根据上面的这些关系，我们可以构建出如下的概念结构模型：

![image-20220602153138271](数据库课程报告/image-20220602153138271.png)

# 二、逻辑结构设计

之后通过powerdesigner将设计好的概念结构模型转换成逻辑结构模型

![image-20220602153318611](数据库课程报告/image-20220602153318611.png)

# 三、物理结构设计

最后通过powerdesigner将逻辑结构模型生成物理结构模型，并生成相应的sql代码。

## 物理结构模型图

![image-20220602153332585](数据库课程报告/image-20220602153332585.png)

## 数据库建立SQL语句

```sql
/*==============================================================*/
/* DBMS name:      MySQL 5.0                                    */
/* Created on:     2022-05-18 10:03:38                          */
/*==============================================================*/

drop table if exists StudentCourse;

drop table if exists CourseClass;

drop table if exists Student;

drop table if exists Teacher;

drop table if exists Class;

drop table if exists Course;

drop table if exists Major;

drop table if exists Faculty;


/*==============================================================*/
/* Table: Class                                                 */
/*==============================================================*/
create table Class
(
   className            varchar(20) not null,
   classCode            varchar(20) not null,
   majorCode            varchar(20) not null,
   primary key (classCode)
);

/*==============================================================*/
/* Table: Course                                                */
/*==============================================================*/
create table Course
(
   courseName           varchar(20) not null,
   courseNature         varchar(20) not null,
   courseCategory       varchar(20) not null,
   courseID             varchar(20) not null,
   facultyCode          varchar(20) not null,
   courseHours          int not null,
   credit               int not null,
   primary key (courseID)
);

/*==============================================================*/
/* Table: CourseClass                                           */
/*==============================================================*/
create table CourseClass
(
   courseClassID        varchar(20) not null,
   courseID             varchar(20) not null,
   teacherID            varchar(20) not null,
   courseClassTime      varchar(20),
   courseClassAddress   varchar(20),
   courseClassWeek      varchar(20),
   primary key (courseClassID)
);

/*==============================================================*/
/* Table: Faculty                                               */
/*==============================================================*/
create table Faculty
(
   facultyName          varchar(20) not null,
   facultyCode          varchar(20) not null,
   facultyAddress       varchar(20),
   facultyTeleno        varchar(20),
   primary key (facultyCode)
);

/*==============================================================*/
/* Table: Major                                                 */
/*==============================================================*/
create table Major
(
   majorName            varchar(20) not null,
   majorCode            varchar(20) not null,
   facultyCode          varchar(20) not null,
   degreeLevel          varchar(20) not null,
   graduationCredits    varchar(20) not null,
   primary key (majorCode)
);

/*==============================================================*/
/* Table: Student                                               */
/*==============================================================*/
create table Student
(
   studentName          varchar(20) not null,
   studentID            varchar(20) not null,
   classCode            varchar(20) not null,
   identifier           varchar(20),
   dormitory            varchar(20),
   address              varchar(100),
   teleno               varchar(20),
   birthday             date,
   sex                  varchar(20),
   grade                varchar(20),
   completedCredits     int,
   primary key (studentID)
);

/*==============================================================*/
/* Table: StudentCourse                                         */
/*==============================================================*/
create table StudentCourse
(
   courseClassID        varchar(20) not null,
   studentID            varchar(20) not null,
   score                int,
   primary key (courseClassID, studentID)
);

/*==============================================================*/
/* Table: Teacher                                               */
/*==============================================================*/
create table Teacher
(
   teacherName          varchar(20) not null,
   teacherID            varchar(20) not null,
   facultyCode          varchar(20) not null,
   primary key (teacherID)
);

alter table Class add constraint FK_Class_Major foreign key (majorCode)
      references Major (majorCode) on delete restrict on update cascade;

alter table Course add constraint FK_CourseFaculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;

alter table CourseClass add constraint FK_CourseOffer foreign key (courseID)
      references Course (courseID) on delete restrict on update cascade;

alter table CourseClass add constraint FK_TeacherTeaching foreign key (teacherID)
      references Teacher (teacherID) on delete restrict on update cascade;

alter table Major add constraint FK_Major_Faculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;

alter table Student add constraint FK_StudentClass foreign key (classCode)
      references Class (classCode) on delete restrict on update cascade;

alter table StudentCourse add constraint FK_StudentCourse foreign key (studentID)
      references Student (studentID) on delete restrict on update cascade;

alter table StudentCourse add constraint FK_StudentCourse2 foreign key (courseClassID)
      references CourseClass (courseClassID) on delete restrict on update cascade;

alter table Teacher add constraint FK_TeacherFaculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;




CREATE TRIGGER credit1
AFTER INSERT  ON studentcourse  -- 在插入后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=new.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;

CREATE TRIGGER credit2
AFTER UPDATE  ON studentcourse  -- 在更新后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=new.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;

CREATE TRIGGER credit3
AFTER DELETE  ON studentcourse  -- 在删除后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=old.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;
```

# 四、数据库后端实现

## 环境要求

编辑器：IDEA

数据库：mysql

语言：java 8

接口测试工具：postman

## 项目整体架构

数据库后端项目基于spring boot，整体分为三层

- 数据持久层

  目的是在java对象与数据库之间建立映射，也就是说它的作用是将某一个Java类对应到数据库中的一张表。在我们的项目中，就将创建一个实体类User映射到数据库的user表，表中的每个字段对应于实体类的每个属性。

  - domain：存放实体类的包，比如User类，其作为对应数据库user表的一个实体类

  - repository: 存放一些数据访问类（也就是一些能操纵数据库的类）的包，比如存放能对user表进行增删改查的类，这一层也仅仅就是基础的增删改查，不附带额外的业务逻辑。

- 业务逻辑层

  的作用是处理业务逻辑。比如在本项目中，我们就在业务逻辑层实现具体插入删除的逻辑，像是插入person要连带着插入user等逻辑都写在这里

  - service: 存放业务逻辑接口的包
  - serviceImpl: 存放业务逻辑实现类的包，其中的类实现service中的接口

- 控制层

  作用是接收视图层的请求并调用业务逻辑层的方法。比如视图层请求插入用户并发来了用户的信息，那么控制层就调用业务逻辑层的登录方法，并将用户信息作为参数传入，在将结果返回给视图层。

  - controller: 存放控制器的包。比如UserController

同时包括额外一些包

- security包

  基于SpringSecurity，提供用户认证和用户授权、登陆注册等功能

- config包

  提供了跨域配置、安全配置等

- utils包

  提供了统一输出结构的工具类等

![20210630010734](数据库课程报告/20210630010734-16541636966865.png)

可以发现这样一个架构就是自底向上的，所以下面我们按照自底向上来创建项目。

### 数据持久层

#### 实体

构建与数据表对应的数据实体

![image-20220602174816807](数据库课程报告/image-20220602174816807.png)

#### dao

实现各个数据表基本的增删改查操作

![image-20220602174844116](数据库课程报告/image-20220602174844116.png)

### 业务逻辑层

通过调用dao层基本的增删改查操作实现每一个模块具体的业务逻辑

![image-20220602175002591](数据库课程报告/image-20220602175002591-16541634052311.png)

### 控制层

调用业务逻辑层的实现，实现后端接口，将接口暴露给前端

![image-20220602180239610](数据库课程报告/image-20220602180239610.png)

### security

实现用户认证和用户授权、登陆注册等功能

![image-20220602180551639](数据库课程报告/image-20220602180551639.png)

## 管理员端

### 登陆认证

### 校建管理

#### 院系管理

#### 专业管理

#### 班级管理

#### 学生管理

### 教师管理

#### 教师信息管理

#### 教师授课管理

### 课程管理

#### 课程信息管理

#### 学生选课管理

## 学生端

## 教师端

# 四、界面设计

## 环境要求

## 项目整体架构



## 管理员端

## 学生端

## 教师端

# 五、项目使用说明

