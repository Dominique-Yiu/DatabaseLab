# 一、概念结构设计

首先我们powerdesigner中设计数据库的概念模型，针对我们要设计的教务管理系统的具体需求，构建了八个数据表

- 院系
- 专业
- 班级
- 学生
- 教师
- 课程
- 学生选课
- 课程班级

对于这些数据表之间的关系

存在如下关系：

学生————n_1————班级

班级————n_1————专业

专业————n_1————院系

教师————n_1————院系

教师————1_n————课程班级

课程————1_n————课程班级

学生————1_n————学生选课

学生选课————1_n————课程班级

根据上面的这些关系，我们可以构建出如下的概念结构模型：

![image-20220602153138271](数据库课程报告/image-20220602153138271.png)

# 二、逻辑结构设计

之后通过powerdesigner将设计好的概念结构模型转换成逻辑结构模型

![image-20220602153318611](数据库课程报告/image-20220602153318611.png)

# 三、物理结构设计

最后通过powerdesigner将逻辑结构模型生成物理结构模型，并生成相应的sql代码。

## 1.物理结构模型图

![image-20220602153332585](数据库课程报告/image-20220602153332585.png)

## 2.数据库建立SQL语句

```sql
/*==============================================================*/
/* DBMS name:      MySQL 5.0                                    */
/* Created on:     2022-05-18 10:03:38                          */
/*==============================================================*/

drop table if exists StudentCourse;

drop table if exists CourseClass;

drop table if exists Student;

drop table if exists Teacher;

drop table if exists Class;

drop table if exists Course;

drop table if exists Major;

drop table if exists Faculty;


/*==============================================================*/
/* Table: Class                                                 */
/*==============================================================*/
create table Class
(
   className            varchar(20) not null,
   classCode            varchar(20) not null,
   majorCode            varchar(20) not null,
   primary key (classCode)
);

/*==============================================================*/
/* Table: Course                                                */
/*==============================================================*/
create table Course
(
   courseName           varchar(20) not null,
   courseNature         varchar(20) not null,
   courseCategory       varchar(20) not null,
   courseID             varchar(20) not null,
   facultyCode          varchar(20) not null,
   courseHours          int not null,
   credit               int not null,
   primary key (courseID)
);

/*==============================================================*/
/* Table: CourseClass                                           */
/*==============================================================*/
create table CourseClass
(
   courseClassID        varchar(20) not null,
   courseID             varchar(20) not null,
   teacherID            varchar(20) not null,
   courseClassTime      varchar(20),
   courseClassAddress   varchar(20),
   courseClassWeek      varchar(20),
   primary key (courseClassID)
);

/*==============================================================*/
/* Table: Faculty                                               */
/*==============================================================*/
create table Faculty
(
   facultyName          varchar(20) not null,
   facultyCode          varchar(20) not null,
   facultyAddress       varchar(20),
   facultyTeleno        varchar(20),
   primary key (facultyCode)
);

/*==============================================================*/
/* Table: Major                                                 */
/*==============================================================*/
create table Major
(
   majorName            varchar(20) not null,
   majorCode            varchar(20) not null,
   facultyCode          varchar(20) not null,
   degreeLevel          varchar(20) not null,
   graduationCredits    varchar(20) not null,
   primary key (majorCode)
);

/*==============================================================*/
/* Table: Student                                               */
/*==============================================================*/
create table Student
(
   studentName          varchar(20) not null,
   studentID            varchar(20) not null,
   classCode            varchar(20) not null,
   identifier           varchar(20),
   dormitory            varchar(20),
   address              varchar(100),
   teleno               varchar(20),
   birthday             date,
   sex                  varchar(20),
   grade                varchar(20),
   completedCredits     int,
   primary key (studentID)
);

/*==============================================================*/
/* Table: StudentCourse                                         */
/*==============================================================*/
create table StudentCourse
(
   courseClassID        varchar(20) not null,
   studentID            varchar(20) not null,
   score                int,
   primary key (courseClassID, studentID)
);

/*==============================================================*/
/* Table: Teacher                                               */
/*==============================================================*/
create table Teacher
(
   teacherName          varchar(20) not null,
   teacherID            varchar(20) not null,
   facultyCode          varchar(20) not null,
   primary key (teacherID)
);

alter table Class add constraint FK_Class_Major foreign key (majorCode)
      references Major (majorCode) on delete restrict on update cascade;

alter table Course add constraint FK_CourseFaculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;

alter table CourseClass add constraint FK_CourseOffer foreign key (courseID)
      references Course (courseID) on delete restrict on update cascade;

alter table CourseClass add constraint FK_TeacherTeaching foreign key (teacherID)
      references Teacher (teacherID) on delete restrict on update cascade;

alter table Major add constraint FK_Major_Faculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;

alter table Student add constraint FK_StudentClass foreign key (classCode)
      references Class (classCode) on delete restrict on update cascade;

alter table StudentCourse add constraint FK_StudentCourse foreign key (studentID)
      references Student (studentID) on delete restrict on update cascade;

alter table StudentCourse add constraint FK_StudentCourse2 foreign key (courseClassID)
      references CourseClass (courseClassID) on delete restrict on update cascade;

alter table Teacher add constraint FK_TeacherFaculty foreign key (facultyCode)
      references Faculty (facultyCode) on delete restrict on update cascade;




CREATE TRIGGER credit1
AFTER INSERT  ON studentcourse  -- 在插入后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=new.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;

CREATE TRIGGER credit2
AFTER UPDATE  ON studentcourse  -- 在更新后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=new.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;

CREATE TRIGGER credit3
AFTER DELETE  ON studentcourse  -- 在删除后修改对应已修学分
FOR EACH ROW
BEGIN
	UPDATE student SET completedCredits=
	(SELECT sum(credit) as sum FROM course,courseclass,studentcourse WHERE
	studentcourse.studentID=old.studentID and 
	studentcourse.score>60 and 
	studentcourse.courseClassID=courseclass.courseClassID and 
	course.courseID=courseclass.courseID);
END;
```

这一部分额外增加了三个触发器，用于在学生选课表更新插入删除后实时修改学生表里的已修学分属性

该属性要求学生成绩大于60分才可以获得某一门课程的学分

# 四、数据库后端实现

## 1.环境要求

编辑器：IDEA

数据库：mysql

语言：java 8

接口测试工具：postman

## 2.项目整体架构

数据库后端项目基于spring boot，整体分为三层

- 数据持久层

  目的是在java对象与数据库之间建立映射，也就是说它的作用是将某一个Java类对应到数据库中的一张表。在我们的项目中，就将创建一个实体类User映射到数据库的user表，表中的每个字段对应于实体类的每个属性。

  - domain：存放实体类的包，比如User类，其作为对应数据库user表的一个实体类

  - repository: 存放一些数据访问类（也就是一些能操纵数据库的类）的包，比如存放能对user表进行增删改查的类，这一层也仅仅就是基础的增删改查，不附带额外的业务逻辑。

- 业务逻辑层

  的作用是处理业务逻辑。比如在本项目中，我们就在业务逻辑层实现具体插入删除的逻辑，像是插入person要连带着插入user等逻辑都写在这里

  - service: 存放业务逻辑接口的包
  - serviceImpl: 存放业务逻辑实现类的包，其中的类实现service中的接口

- 控制层

  作用是接收视图层的请求并调用业务逻辑层的方法。比如视图层请求插入用户并发来了用户的信息，那么控制层就调用业务逻辑层的登录方法，并将用户信息作为参数传入，在将结果返回给视图层。

  - controller: 存放控制器的包。比如UserController

同时包括额外一些包

- security包

  基于SpringSecurity，提供用户认证和用户授权、登陆注册等功能

- config包

  提供了跨域配置、安全配置等

- utils包

  提供了统一输出结构的工具类等

![20210630010734](数据库课程报告/20210630010734-16541636966865.png)

可以发现这样一个架构就是自底向上的，所以下面我们按照自底向上来创建项目。

### 2.1 数据持久层

**实体**

构建与数据表对应的数据实体

![image-20220602174816807](数据库课程报告/image-20220602174816807.png)

**dao**

实现各个数据表基本的增删改查操作

![image-20220602174844116](数据库课程报告/image-20220602174844116.png)

### 2.2 业务逻辑层

通过调用dao层基本的增删改查操作实现每一个模块具体的业务逻辑

![image-20220602175002591](数据库课程报告/image-20220602175002591-16541634052311.png)

### 2.3 控制层

调用业务逻辑层的实现，实现后端接口，将接口暴露给前端

![image-20220602180239610](数据库课程报告/image-20220602180239610.png)

### 2.4 security

实现用户认证和用户授权、登陆注册等功能

![image-20220602180551639](数据库课程报告/image-20220602180551639.png)

## 3.实现源码

### 3.1 登陆认证

### 3.2 校建管理

#### 3.2.1 院系管理

##### Faculty实体

```java
package com.lab.backend.domain;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Table(name = "Faculty")
@Entity
public class Faculty {
    private String facultyName;
    @Id
    private String facultyCode;
    private String facultyAddress;
    private String facultyTeleno;

    public Faculty() {
    }

    public Faculty(String facultyName, String facultyCode, String facultyAddress, String facultyTeleno) {
        this.facultyName = facultyName;
        this.facultyCode = facultyCode;
        this.facultyAddress = facultyAddress;
        this.facultyTeleno = facultyTeleno;
    }

    public String getFacultyName() {
        return facultyName;
    }

    public void setFacultyName(String facultyName) {
        this.facultyName = facultyName;
    }

    public String getFacultyCode() {
        return facultyCode;
    }

    public void setFacultyCode(String facultyCode) {
        this.facultyCode = facultyCode;
    }

    public String getFacultyAddress() {
        return facultyAddress;
    }

    public void setFacultyAddress(String facultyAddress) {
        this.facultyAddress = facultyAddress;
    }

    public String getFacultyTeleno() {
        return facultyTeleno;
    }

    public void setFacultyTeleno(String facultyTeleno) {
        this.facultyTeleno = facultyTeleno;
    }
}

```

##### FacultyDao

实现基本的数据库增删改查操作



```java
package com.lab.backend.repository;

import com.lab.backend.domain.Faculty;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;


@Repository
public class FacultyDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * 插入
     * @param faculty 院系实体
     */
    public void insert(Faculty faculty) {
        String sql="insert into faculty values (?,?,?,?)";
        jdbcTemplate.update(sql,
                faculty.getFacultyName(),
                faculty.getFacultyCode(),
                faculty.getFacultyAddress(),
                faculty.getFacultyTeleno());
    }

    /**
     * 删除
     * @param facultyCode 院系代码
     */
    public void delete(String facultyCode) {
        String sql="delete from Faculty where facultyCode = ?";
        jdbcTemplate.update(sql, facultyCode);
    }

    /**
     * 更新
     * @param faculty 院系实体
     */
    public void update(Faculty faculty) {
        String sql="UPDATE faculty SET facultyName=?,facultyAddress=?, facultyTeleno=? WHERE facultyCode=?";
        jdbcTemplate.update(sql,
                faculty.getFacultyName(),
                faculty.getFacultyAddress(),
                faculty.getFacultyTeleno(),
                faculty.getFacultyCode());
    }

    /**
     * 按Code查询
     */
    public List<Faculty> getByCode(String code) {
        String sql="select * from faculty where facultyCode=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Faculty(
                rs.getString("facultyName"),
                rs.getString("facultyCode"),
                rs.getString("facultyAddress"),
                rs.getString("facultyTeleno")
        ),code);
    }

    /**
     * 按某一个属性查询
     * @param attribute 要查询的属性
     * @param name 要查询的属性值
     * @return 查询结果
     */
    public List<Faculty> getByAttribute(String attribute,String name) {
        String sql="select * from faculty where "+attribute+" like ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Faculty(
                rs.getString("facultyName"),
                rs.getString("facultyCode"),
                rs.getString("facultyAddress"),
                rs.getString("facultyTeleno")
        ),name);
    }

    /**
     * 多条件模糊查询
     * @param faculty 院系实体
     * @param pageIndex 起始页
     * @param pageSize  每页个数
     * @return result
     */
    public Map<Object, Object> query(Faculty faculty, int pageIndex, int pageSize){
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql =new StringBuilder("select * from faculty where 1=1");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        String facultyName = faculty.getFacultyName();
        if(facultyName != null && !facultyName.trim().isEmpty()){
            sql.append(" and facultyName like ?");
            params.add("%" +facultyName+ "%");
        }
        String facultyCode= faculty.getFacultyCode();
        if(facultyCode != null && !facultyCode.trim().isEmpty()){
            sql.append(" and facultyCode like ?");
            params.add("%" +facultyCode+ "%");
        }

        String facultyAddress= faculty.getFacultyAddress();
        if(facultyAddress != null && !facultyAddress.trim().isEmpty()){
            sql.append(" and facultyAddress like ?");
            params.add("%" +facultyAddress+ "%");
        }

        String facultyTeleno= faculty.getFacultyTeleno();
        if(facultyTeleno != null && !facultyTeleno.trim().isEmpty()){
            sql.append(" and facultyTeleno like ?");
            params.add("%" +facultyTeleno+ "%");
        }
        //统计个数
        String sql2="SELECT count(*) as sum from ("+ sql +") as a;";
        int count=jdbcTemplate.queryForObject(sql2, Integer.class,params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex-1)*pageSize);
        params.add(pageSize);



        Map<Object, Object> response=new HashMap<>();
        response.put("total",count);
        response.put("pageIndex",pageIndex);
        response.put("tableData",jdbcTemplate.query(sql.toString(), (rs, rowNum) -> new Faculty(
                rs.getString("facultyName"),
                rs.getString("facultyCode"),
                rs.getString("facultyAddress"),
                rs.getString("facultyTeleno")
        ),params.toArray()));

        return response;
    }
}

```

##### FacultyImpl

接口

```java
package com.lab.backend.service;

import com.lab.backend.domain.Faculty;
import org.springframework.stereotype.Service;


import java.util.List;
import java.util.Map;

@Service
public interface FacultyService {
    boolean insert(Faculty faculty);

    int delete(String facultyCode);

    boolean update(Faculty faculty);
    
    Map<Object, Object> query(Faculty faculty, int pageIndex, int pageSize);
}

```

接口实现

```java
package com.lab.backend.service.impl;

import com.lab.backend.domain.Faculty;
import com.lab.backend.repository.FacultyDao;
import com.lab.backend.repository.MajorDao;
import com.lab.backend.service.FacultyService;
import org.springframework.stereotype.Service;


import javax.annotation.Resource;
import java.util.List;
import java.util.Map;

@Service
public class FacultyServiceImpl  implements FacultyService {
    @Resource
    private FacultyDao facultyDao;
    @Resource
    private MajorDao majorDao;
    /**
     * 插入
     * @param faculty 院系实体
     * @return 执行结果
     */
    @Override
    public boolean insert(Faculty faculty) {
        int num=facultyDao.getByCode(faculty.getFacultyCode()).size();
        if(num==0){
            facultyDao.insert(faculty);
            return true;
        }
        else {
            return false;
        }
    }
    /**
     * 删除
     * @param facultyCode 院系代码
     * @return int 0成功,1失败
     */
    @Override
    public int delete(String facultyCode) {
        int num=facultyDao.getByCode(facultyCode).size();
        int majorNum=majorDao.getByAttribute("facultyCode",facultyCode).size();
        if(num!=0){
            if(majorNum==0){
                facultyDao.delete(facultyCode);
                return 0;
            }
            else{
                return 1;//该院系下专业非空，无法删除
            }
        }
        else {
            return 2;//院系不存在
        }
    }
    /**
     * 更新
     * @param faculty 院系实体
     * @return int 0成功,1失败
     */
    @Override
    public boolean update(Faculty faculty) {
        int num=facultyDao.getByCode(faculty.getFacultyCode()).size();
        if(num!=0){
            facultyDao.update(faculty);
            return true;
        }
        else {
            return false;
        }
    }
    /**
     * 多条件查询
     * @param faculty 院系实体
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Faculty faculty, int pageIndex, int pageSize){
        return facultyDao.query(faculty,pageIndex,pageSize);
    }
}

```

##### FacultyController

```java
package com.lab.backend.controller;

import com.lab.backend.domain.Faculty;
import com.lab.backend.service.FacultyService;
import com.lab.backend.utils.Result;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import javax.annotation.Resource;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/faculty")
public class FacultyController {
    @Resource
    private FacultyService facultyService;
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Faculty> insertController(@RequestBody Faculty faculty){
        if(facultyService.insert(faculty)){
            return Result.success(faculty);
        }
        else{
            return Result.error("1","当前记录已存在，插入失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Faculty> deleteController(@RequestBody Faculty faculty){
        if(facultyService.update(faculty)){
            return Result.success(faculty);
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> updateController(@RequestParam String facultyCode){
        int r=facultyService.delete(facultyCode);
        if(r==0){
            return Result.success(facultyCode);
        }
        else if(r==1){
            return Result.error("1","该院系下专业非空，无法删除");
        }
        else{
            return Result.error("1","当前记录不存在，删除失败！");
        }
    }

    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Faculty faculty, @RequestParam int pageIndex, @RequestParam int pageSize){
        Map<Object, Object> response =facultyService.query(faculty,pageIndex,pageSize);
        if((int)response.get("total")!=0){
            return Result.success(response,"查询成功");
        }else{
            return Result.error("1","查询结果为空");
        }
    }



}

```

#### 3.2.2 专业管理

##### Major实体

```java
package com.lab.backend.domain;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Table(name = "Major")
@Entity
public class Major {
    private String majorName;
    @Id
    private String majorCode;
    private String facultyCode;
    private String degreeLevel;
    private String graduationCredits;

    public Major() {

    }

    public Major(String majorName, String majorCode, String facultyCode, String degreeLevel, String graduationCredits) {
        this.majorName = majorName;
        this.majorCode = majorCode;
        this.facultyCode = facultyCode;
        this.degreeLevel = degreeLevel;
        this.graduationCredits = graduationCredits;
    }

    public String getMajorName() {
        return majorName;
    }

    public void setMajorName(String majorName) {
        this.majorName = majorName;
    }

    public String getMajorCode() {
        return majorCode;
    }

    public void setMajorCode(String majorCode) {
        this.majorCode = majorCode;
    }

    public String getFacultyCode() {
        return facultyCode;
    }

    public void setFacultyCode(String facultyCode) {
        this.facultyCode = facultyCode;
    }

    public String getDegreeLevel() {
        return degreeLevel;
    }

    public void setDegreeLevel(String degreeLevel) {
        this.degreeLevel = degreeLevel;
    }

    public String getGraduationCredits() {
        return graduationCredits;
    }

    public void setGraduationCredits(String graduationCredits) {
        this.graduationCredits = graduationCredits;
    }
}

```

##### MajorDao

```java
package com.lab.backend.repository;


import com.lab.backend.domain.Faculty;
import com.lab.backend.domain.Major;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import javax.annotation.Resource;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;


@Repository
public class MajorDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     * @param major 专业实体
     */
    public void insert(Major major) {
        String sql="insert into major values (?,?,?,?,?)";
        jdbcTemplate.update(sql,
                major.getMajorName(),
                major.getMajorCode(),
                major.getFacultyCode(),
                major.getDegreeLevel(),
                major.getGraduationCredits());
    }

    /**
     * 删除
     * @param majorCode 专业代码
     */
    public void delete(String majorCode) {
        String sql="delete from major where majorCode = ?";
        jdbcTemplate.update(sql, majorCode);
    }

    /**
     * 更新
     * @param major 专业实体
     */
    public void update(Major major) {
        String sql="UPDATE major SET majorName=?,facultyCode=?, degreeLevel=? ,graduationCredits=? WHERE majorCode=?";
        jdbcTemplate.update(sql,
                major.getMajorName(),
                major.getFacultyCode(),
                major.getDegreeLevel(),
                major.getGraduationCredits(),
                major.getMajorCode());
    }

    /**
     * 按某一个属性查询
     * @param attribute 要查询的属性
     * @param name 要查询的属性值
     * @return 查询结果
     */
    public List<Major> getByAttribute(String attribute, String name) {
        String sql="select * from major where "+attribute+" like ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Major(
                rs.getString("majorName"),
                rs.getString("majorCode"),
                rs.getString("facultyCode"),
                rs.getString("degreeLevel"),
                rs.getString("graduationCredits")
        ),name);
    }

    /**
     * 按Code查询
     */
    public List<Major> getByCode(String code) {
        String sql="select * from major where majorCode=?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Major(
                rs.getString("majorName"),
                rs.getString("majorCode"),
                rs.getString("facultyCode"),
                rs.getString("degreeLevel"),
                rs.getString("graduationCredits")
        ),code);
    }


    /**
     * 多条件模糊查询
     * @param major 专业实体
     * @param facultyName 要查询的院系名称
     * @param pageIndex 起始页
     * @param pageSize 每页个数
     * @return 查询结果
     */
    public Map<Object, Object> query(Major major,String facultyName,int pageIndex, int pageSize){
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql =new StringBuilder("select faculty.facultyCode,facultyName,major.majorCode,majorName,degreeLevel,graduationCredits from major,faculty where major.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句


        String majorName = major.getMajorName();
        if(majorName != null && !majorName.trim().isEmpty()){
            sql.append(" and majorName like ?");
            params.add("%" +majorName+ "%");
        }
        String majorCode= major.getMajorCode();
        if(majorCode != null && !majorCode.trim().isEmpty()){
            sql.append(" and majorCode like ?");
            params.add("%" +majorCode+ "%");
        }

        String facultyCode= major.getFacultyCode();
        if(facultyCode != null && !facultyCode.trim().isEmpty()){
            sql.append(" and major.facultyCode like ?");
            params.add("%" +facultyCode+ "%");
        }

        String degreeLevel= major.getDegreeLevel();
        if(degreeLevel != null && !degreeLevel.trim().isEmpty()){
            sql.append(" and degreeLevel like ?");
            params.add("%" +degreeLevel+ "%");
        }
        String graduationCredits= major.getGraduationCredits();
        if(graduationCredits != null && !graduationCredits.trim().isEmpty()){
            sql.append(" and graduationCredits like ?");
            params.add("%" +graduationCredits+ "%");
        }

        if(facultyName != null && !facultyName.trim().isEmpty()){
            sql.append(" and facultyName like ?");
            params.add("%" +facultyName+ "%");
        }

        //统计个数
        String sql2="SELECT count(*) as sum from ("+ sql +") as a;";
        int count=jdbcTemplate.queryForObject(sql2, Integer.class,params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex-1)*pageSize);
        params.add(pageSize);



        Map<Object, Object> response=new HashMap<>();
        response.put("total",count);
        response.put("pageIndex",pageIndex);
        response.put("tableData",jdbcTemplate.queryForList(sql.toString(), params.toArray()));

        return response;
    }
}

```

##### MajorImpl

接口

```java
package com.lab.backend.service;

import com.lab.backend.domain.Major;
import org.springframework.stereotype.Service;

import java.util.Map;

@Service
public interface MajorService {
    int insert(Major major);

    int delete(String majorCode);

    int update(Major major);
    
    Map<Object, Object> query(Major major, String facultyName, int pageIndex, int pageSize);
}

```

接口实现

```java
package com.lab.backend.service.impl;

import com.lab.backend.domain.Major;
import com.lab.backend.repository.ClassDao;
import com.lab.backend.repository.FacultyDao;
import com.lab.backend.repository.MajorDao;
import com.lab.backend.service.MajorService;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;

import java.util.Map;

@Service
public class MajorServiceImpl implements MajorService {
    @Resource
    private MajorDao majorDao;
    @Resource
    private FacultyDao facultyDao;
    @Resource
    private ClassDao classDao;
    /**
     * 插入
     * @param major 专业实体
     * @return 执行结果
     */
    @Override
    public int insert(Major major) {
        int num=majorDao.getByCode(major.getMajorCode()).size();
        int facultyNum=facultyDao.getByCode(major.getFacultyCode()).size();
        if(num==0){
            if(facultyNum!=0){
                majorDao.insert(major);
                return 0;//成功插入
            }
            else{
                return 1;//院系不存在，无法插入
            }
        }
        else {
            return 2;//当前专业已存在，无法插入
        }
    }
    /**
     * 删除
     * @param majorCode 专业代码
     * @return int 0成功,1失败
     */
    @Override
    public int delete(String majorCode) {
        int num=majorDao.getByCode(majorCode).size();
        int classNum=classDao.getByAttribute("majorCode",majorCode).size();
        if(num!=0){
            if(classNum==0){
                majorDao.delete(majorCode);
                return 0;
            }
            else {
                return 1;//该专业下班级非空，无法删除
            }
        }
        else {
            return 2;//专业不存在，无法删除
        }
    }


    /**
     * 更新
     * @param major 专业实体
     * @return int 0成功,1失败
     */
    @Override
    public int update(Major major) {
        int num=majorDao.getByCode(major.getMajorCode()).size();
        int facultyNum=facultyDao.getByCode(major.getFacultyCode()).size();
        if(num!=0){
            if(facultyNum!=0){
                majorDao.update(major);
                return 0;//成功更新
            }
            else{
                return 1;//院系不存在，无法更新
            }
        }
        else {
            return 2;//当前专业不存在，无法更新
        }
    }



    /**
     * 多条件查询
     * @param major 专业实体
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Major major, String facultyName, int pageIndex, int pageSize){
        return majorDao.query(major,facultyName,pageIndex,pageSize);
    }
}

```

##### MajorController



```java
package com.lab.backend.controller;

import com.lab.backend.domain.Major;
import com.lab.backend.service.MajorService;
import com.lab.backend.utils.Result;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import javax.annotation.Resource;
import java.util.Map;

@RestController
@RequestMapping("/major")
public class MajorController {
    @Resource
    private MajorService majorService;
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Major> insertController(@RequestBody Major major){
        int r=majorService.insert(major);
        if(r==0){
            return Result.success(major);
        }
        else if(r==1){
            return Result.error("1","院系不存在，无法插入！");
        }
        else{
            return Result.error("1","当前记录已存在，插入失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Major> deleteController(@RequestBody Major major){
        int r=majorService.update(major);
        if(r==0){
            return Result.success(major);
        }
        else if(r==1){
            return Result.error("1","院系不存在，无法更新！");
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> updateController(@RequestParam String majorCode){
        int r=majorService.delete(majorCode);
        if(r==0){
            return Result.success(majorCode);
        }
        else if(r==1){
            return Result.error("1","该专业下班级非空，无法删除！");
        }
        else{
            return Result.error("1","当前记录不存在，删除失败！");
        }
    }

    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Major major,String facultyName,@RequestParam int pageIndex, @RequestParam int pageSize){
        Map<Object, Object> response =majorService.query(major,facultyName,pageIndex,pageSize);
        if((int)response.get("total")!=0){
            return Result.success(response,"查询成功");
        }else{
            return Result.error("1","查询结果为空");
        }
    }

}

```

#### 3.2.3 班级管理

##### Class实体

```java
package com.lab.backend.domain;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Table(name = "Class")
@Entity
public class Classes {
    private String className;
    @Id
    private String classCode;
    private String majorCode;

    public Classes() {
    }

    public Classes(String className, String classCode, String majorCode) {
        this.className = className;
        this.classCode = classCode;
        this.majorCode = majorCode;
    }

    public String getClassName() {
        return className;
    }

    public void setClassName(String className) {
        this.className = className;
    }

    public String getClassCode() {
        return classCode;
    }
    public void setClassCode(String classCode) {
        this.classCode = classCode;
    }

    public String getMajorCode() {
        return majorCode;
    }

    public void setMajorCode(String majorCode) {
        this.majorCode = majorCode;
    }
}

```

##### ClassDao

```java
package com.lab.backend.repository;

import com.lab.backend.domain.Classes;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Repository
public class ClassDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     * @param classes 班级实体
     */
    public void insert(Classes classes) {
        String sql="insert into class values (?,?,?)";
        jdbcTemplate.update(sql,
                classes.getClassName(),
                classes.getClassCode(),
                classes.getMajorCode());
    }

    /**
     * 删除
     * @param classCode 班级代码
     */
    public void delete(String classCode) {
        String sql="delete from class where classCode = ?";
        jdbcTemplate.update(sql, classCode);
    }

    /**
     * 更新
     * @param classes 班级实体
     */
    public void update(Classes classes) {
        String sql="UPDATE class SET className=?, MajorCode=? WHERE classCode=?";
        jdbcTemplate.update(sql,
                classes.getClassName(),
                classes.getMajorCode(),
                classes.getClassCode());
    }

    /**
     * 按某一个属性查询
     * @param attribute 要查询的属性
     * @param name 要查询的属性值
     * @return 查询结果
     */
    public List<Classes> getByAttribute(String attribute, String name) {
        String sql="select * from class where "+attribute+" like ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Classes(
                rs.getString("className"),
                rs.getString("classCode"),
                rs.getString("majorCode")
        ),name);
    }
    /**
     * 按code查询
     */
    public List<Classes> getByCode(String code) {
        String sql="select * from class where classCode = ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Classes(
                rs.getString("className"),
                rs.getString("classCode"),
                rs.getString("majorCode")
        ),code);
    }

    /**
     * 多条件模糊查询
     * @param classes 学生实体
     * @param majorName 要查询的专业名称
     * @param facultyName 要查询的院系名称
     * @param pageIndex 起始页
     * @param pageSize  每页个数
     * @return result
     */
    public Map<Object, Object> query(Classes classes, String majorName, String facultyName, int pageIndex, int pageSize){
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql =new StringBuilder("select major.facultyCode,facultyName,class.majorCode,majorName,classCode,className from class,major,faculty where class.majorCode=major.majorCode and major.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        String className = classes.getClassName();
        if(className != null && !className.trim().isEmpty()){
            sql.append(" and className like ?");
            params.add("%" +className+ "%");
        }

        String classCode = classes.getClassCode();
        if(classCode != null && !classCode.trim().isEmpty()){
            sql.append(" and classCode like ?");
            params.add("%" +classCode+ "%");
        }

        String majorCode= classes.getMajorCode();
        if(majorCode != null && !majorCode.trim().isEmpty()){
            sql.append(" and class.majorCode like ?");
            params.add("%" +majorCode+ "%");
        }

        if(majorName != null && !majorName.trim().isEmpty()){
            sql.append(" and majorName like ?");
            params.add("%" +majorName+ "%");
        }
        if(facultyName != null && !facultyName.trim().isEmpty()){
            sql.append(" and facultyName like ?");
            params.add("%" +facultyName+ "%");
        }

        //统计个数
        String sql2="SELECT count(*) as sum from ("+ sql +") as a;";
        int count=jdbcTemplate.queryForObject(sql2, Integer.class,params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex-1)*pageSize);
        params.add(pageSize);



        Map<Object, Object> response=new HashMap<>();
        response.put("total",count);
        response.put("pageIndex",pageIndex);
        response.put("tableData",jdbcTemplate.queryForList(sql.toString(), params.toArray()));

        return response;
    }
}

```

##### ClassImpl

接口

```java
package com.lab.backend.service;

import com.lab.backend.domain.Classes;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Map;

@Service
public interface ClassService {
    int insert(Classes classes);

    int delete(String classCode);

    int update(Classes classes);

    Map<Object, Object> query(Classes classes, String majorName, String facultyName,int pageIndex, int pageSize);
}

```

接口实现

```java
package com.lab.backend.service.impl;

import com.lab.backend.domain.Classes;
import com.lab.backend.domain.Major;
import com.lab.backend.repository.ClassDao;
import com.lab.backend.repository.MajorDao;
import com.lab.backend.repository.StudentDao;
import com.lab.backend.service.ClassService;

import org.springframework.stereotype.Service;

import javax.annotation.Resource;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Service
public class ClassServiceImpl implements ClassService {
    @Resource
    private ClassDao classDao;
    @Resource
    private MajorDao majorDao;
    @Resource
    private StudentDao studentDao;
    /**
     * 插入
     * @param classes 班级实体
     * @return 执行结果
     */
    @Override
    public int insert(Classes classes) {
        int num=classDao.getByCode(classes.getClassCode()).size();
        int majorNum=majorDao.getByCode(classes.getMajorCode()).size();
        if(num==0){
            if(majorNum!=0){
                classDao.insert(classes);
                return 0;//成功插入
            }
            else{
                return 1;//专业不存在，无法插入
            }
        }
        else {
            return 2;//当前班级已存在，无法插入
        }
    }
    /**
     * 删除
     * @param classCode 班级代码
     * @return int 0成功,1失败
     */
    @Override
    public int delete(String classCode) {
        int num=classDao.getByCode(classCode).size();
        int studentNum=studentDao.getByAttribute("classCode",classCode).size();
        if(num!=0){
            if(studentNum==0){
                classDao.delete(classCode);
                return 0;
            }
            else {
                return 1;//该班级下学生非空，无法删除
            }
        }
        else {
            return 2;//学生不存在，无法删除
        }
    }
    /**
     * 更新
     * @param classes 班级实体
     * @return int 0成功,1失败
     */
    @Override
    public int update(Classes classes) {
        int num=classDao.getByCode(classes.getClassCode()).size();
        int majorNum=majorDao.getByCode(classes.getMajorCode()).size();
        if(num!=0){
            if(majorNum!=0){
                classDao.update(classes);
                return 0;//成功更新
            }
            else{
                return 1;//专业不存在，无法更新
            }
        }
        else {
            return 2;//当前班级不存在，无法更新
        }
    }

    /**
     * 多条件查询
     * @param classes 班级实体
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Classes classes, String majorName, String facultyName, int pageIndex, int pageSize){
        return classDao.query(classes,majorName,facultyName,pageIndex,pageSize);
    }
}

```

##### ClassController

```java
package com.lab.backend.controller;

import com.lab.backend.domain.Classes;
import com.lab.backend.service.ClassService;
import com.lab.backend.utils.Result;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.ServletRequestBindingException;
import org.springframework.web.bind.annotation.*;
import javax.annotation.Resource;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/class")
public class ClassController {
    @Resource
    private ClassService classService;

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Classes> insertController(@RequestBody Classes classes){
        int r=classService.insert(classes);
        if(r==0){
            return Result.success(classes);
        }
        else if(r==1){
            return Result.error("1","对应专业不存在，无法插入！");
        }
        else{
            return Result.error("1","当前记录已存在，插入失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Classes> deleteController(@RequestBody Classes classes){
        int r=classService.update(classes);
        if(r==0){
            return Result.success(classes);
        }
        else if(r==1){
            return Result.error("1","对应专业不存在，无法更新！");
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> updateController(@RequestParam String classCode){
        int r=classService.delete(classCode);
        if(r==0){
            return Result.success(classCode);
        }
        else if(r==1){
            return Result.error("1","该班级下学生非空，无法删除！");
        }
        else{
            return Result.error("1","当前记录不存在，删除失败！");
        }
    }

    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Classes classes, String majorName, String facultyName, @RequestParam int pageIndex, @RequestParam int pageSize){
        Map<Object, Object> response =classService.query(classes,majorName,facultyName,pageIndex,pageSize);
        if((int)response.get("total")!=0){
            return Result.success(response,"查询成功");
        }else{
            return Result.error("1","查询结果为空");
        }
    }

}

```

#### 3.2.4 学生管理

##### Student实体

```java
package com.lab.backend.domain;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Table(name="Student")
@Entity
public class Student {
    private String studentName;
    @Id
    private String studentID;
    private String classCode;
    private String identifier;
    private String dormitory;
    private String address;
    private String teleno;
    private String birthday;
    private String sex;
    private String grade;
    private String completedCredits;

    public Student() {

    }

    public Student(String studentName, String studentID, String classCode, String identifier, String dormitory, String address, String teleno, String birthday, String sex, String grade, String completedCredits) {
        this.studentName = studentName;
        this.studentID = studentID;
        this.classCode = classCode;
        this.identifier = identifier;
        this.dormitory = dormitory;
        this.address = address;
        this.teleno = teleno;
        this.birthday = birthday;
        this.sex = sex;
        this.grade = grade;
        this.completedCredits = completedCredits;
    }

    public String getStudentName() {
        return studentName;
    }

    public String getStudentID() {
        return studentID;
    }

    public String getClassCode() {
        return classCode;
    }

    public String getIdentifier() {
        return identifier;
    }

    public String getDormitory() {
        return dormitory;
    }

    public String getAddress() {
        return address;
    }

    public String getTeleno() {
        return teleno;
    }

    public String getBirthday() {
        return birthday;
    }

    public String getSex() {
        return sex;
    }

    public String getGrade() {
        return grade;
    }

    public String getCompletedCredits() {
        return completedCredits;
    }

    public void setClassCode(String classCode) {
        this.classCode = classCode;
    }

    public void setStudentName(String studentName) {
        this.studentName = studentName;
    }

    public void setStudentID(String studentID) {
        this.studentID = studentID;
    }

    public void setIdentifier(String identifier) {
        this.identifier = identifier;
    }

    public void setDormitory(String dormitory) {
        this.dormitory = dormitory;
    }

    public void setAddress(String address) {
        this.address = address;
    }

    public void setTeleno(String teleno) {
        this.teleno = teleno;
    }

    public void setBirthday(String birthday) {
        this.birthday = birthday;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public void setGrade(String grade) {
        this.grade = grade;
    }

    public void setCompletedCredits(String completedCredits) {
        this.completedCredits = completedCredits;
    }
}

```

##### StudentDao

```java
package com.lab.backend.repository;

import com.lab.backend.domain.Student;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;
import java.util.*;

@Repository
public class StudentDao {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
     * 插入
     * @param student student实体
     * @return student实体
     */
    public Student insert(Student student) {
        String sql="insert into student values (?,?,?,?,?,?,?,?,?,?,?)";
        jdbcTemplate.update(sql,
                student.getStudentName(),
                student.getStudentID(),
                student.getClassCode(),
                student.getIdentifier(),
                student.getDormitory(),
                student.getAddress(),
                student.getTeleno(),
                student.getBirthday(),
                student.getSex(),
                student.getGrade(),
                student.getCompletedCredits());
        return student;
    }

    /**
     * 删除
     */
    public void delete(String studentID) {
        String sql="delete from student where studentID = ?";
        jdbcTemplate.update(sql, studentID);
    }

    /**
     * 更新
     */
    public void update(Student student) {
        String sql="UPDATE student SET " +
                "studentName=?, " +
                "classCode=?, " +
                "identifier=?, " +
                "dormitory=?, " +
                "address=?," +
                "teleno=?," +
                "birthday=?," +
                "sex=?," +
                "grade=?," +
                "completedCredits=?" +
                "WHERE studentId=?";
        jdbcTemplate.update(sql,
                student.getStudentName(),
                student.getClassCode(),
                student.getIdentifier(),
                student.getDormitory(),
                student.getAddress(),
                student.getTeleno(),
                student.getBirthday(),
                student.getSex(),
                student.getGrade(),
                student.getCompletedCredits(),
                student.getStudentID());
    }

    /**
     * 按某一个属性查询
     * @param attribute 要查询的属性
     * @param value 要查询的属性值
     * @return 查询结果
     */
    public List<Student> getByAttribute(String attribute, String value) {
        String sql="select * from student where "+attribute+" like ?";
        return jdbcTemplate.query(sql, (rs, rowNum) -> new Student(
                rs.getString("studentName"),
                rs.getString("studentID"),
                rs.getString("classCode"),
                rs.getString("identifier"),
                rs.getString("dormitory"),
                rs.getString("address"),
                rs.getString("teleno"),
                rs.getString("birthday"),
                rs.getString("sex"),
                rs.getString("grade"),
                rs.getString("completedCredits")
        ),value);
    }
    /**
     * 学生更新可修改的个人信息
     */
    public void updateByStudent(Student student) {
        String sql="UPDATE student SET " +
                "studentName=?, " +
                "identifier=?, " +
                "dormitory=?, " +
                "address=?," +
                "teleno=?," +
                "birthday=?," +
                "sex=?" +
                "WHERE studentId = ?";
        jdbcTemplate.update(sql,
                student.getStudentName(),
                student.getStudentID(),
                student.getDormitory(),
                student.getAddress(),
                student.getTeleno(),
                student.getBirthday(),
                student.getSex(),
                student.getStudentID());
    }
    /**
     * 按Code查询
     */
    public List<Map<String, Object>> getByID(String ID) {
        String sql="select facultyName,faculty.facultyCode,majorName,major.majorCode,className,student.classCode,studentName,studentID,identifier,dormitory,address,teleno,birthday,sex,grade,completedCredits from student,class,major,faculty where student.classCode=class.classCode and class.majorCode=major.majorCode and major.facultyCode=faculty.facultyCode and studentID=?";
        return jdbcTemplate.queryForList(sql,ID);
    }

    /**
     * 多条件模糊查询
     * @param student 学生实体
     * @param className 要查询的班级名称
     * @param majorName 要查询的专业名称
     * @param facultyName 要查询的院系名称
     * @param pageIndex 起始页
     * @param pageSize  每页个数
     * @return 查询结果
     */
    public Map<Object, Object> query(Student student,String className,String majorName,String facultyName,int pageIndex,int pageSize){
        //给出sql模板,为了便于后面添加sql语句
        StringBuilder sql =new StringBuilder("select faculty.facultyCode,facultyName,major.majorCode,\tmajorName,student.classCode,className,studentName,studentID,identifier,dormitory,address,teleno,birthday,sex,grade,completedCredits from student,class,major,faculty where 1=1 and student.classCode=class.classCode and class.majorCode=major.majorCode and major.facultyCode=faculty.facultyCode");
        //给出params
        List<Object> params = new ArrayList<>();
        //构造查询语句
        String studentID = student.getStudentID();
        if(studentID != null && !studentID.trim().isEmpty()){
            sql.append(" and studentID like ?");
            params.add("%" +studentID+ "%");
        }
        String studentName= student.getStudentName();
        if(studentName != null && !studentName.trim().isEmpty()){
            sql.append(" and studentName like ?");
            params.add("%" +studentName+ "%");
        }

        String classCode= student.getClassCode();
        if(classCode != null && !classCode.trim().isEmpty()){
            sql.append(" and student.classCode like ?");
            params.add("%" +classCode+ "%");
        }

        String identifier= student.getIdentifier();
        if(identifier != null && !identifier.trim().isEmpty()){
            sql.append(" and identifier like ?");
            params.add("%" +identifier+ "%");
        }
        String dormitory= student.getDormitory();
        if(dormitory != null && !dormitory.trim().isEmpty()){
            sql.append(" and dormitory like ?");
            params.add("%" +dormitory+ "%");
        }
        String address= student.getAddress();
        if(address != null && !address.trim().isEmpty()){
            sql.append(" and address like ?");
            params.add("%" +address+ "%");
        }
        String teleno= student.getTeleno();
        if(teleno != null && !teleno.trim().isEmpty()){
            sql.append(" and teleno like ?");
            params.add("%" +teleno+ "%");
        }
        String birthday= student.getBirthday();
        if(birthday != null && !birthday.trim().isEmpty()){
            sql.append(" and birthday like ?");
            params.add("%" +birthday+ "%");
        }
        String sex= student.getSex();
        if(sex != null && !sex.trim().isEmpty()){
            sql.append(" and sex like ?");
            params.add("%" +sex+ "%");
        }
        String grade= student.getGrade();
        if(grade != null && !grade.trim().isEmpty()){
            sql.append(" and grade like ?");
            params.add("%" +grade+ "%");
        }
        String completedCredits= student.getCompletedCredits();
        if(completedCredits != null && !completedCredits.trim().isEmpty()){
            sql.append(" and completedCredits like ?");
            params.add("%" +completedCredits+ "%");
        }

        if(className != null && !className.trim().isEmpty()){
            sql.append(" and className like ?");
            params.add("%" +className+ "%");
        }
        if(majorName != null && !majorName.trim().isEmpty()){
            sql.append(" and majorName like ?");
            params.add("%" +majorName+ "%");
        }
        if(facultyName != null && !facultyName.trim().isEmpty()){
            sql.append(" and facultyName like ?");
            params.add("%" +facultyName+ "%");
        }


        //统计个数
        String sql2="SELECT count(*) as sum from ("+ sql +") as a;";
        int count=jdbcTemplate.queryForObject(sql2, Integer.class,params.toArray());
        //添加页数条目限制
        sql.append(" limit ?,?");
        params.add((pageIndex-1)*pageSize);
        params.add(pageSize);



        Map<Object, Object> response=new HashMap<>();
        response.put("total",count);
        response.put("pageIndex",pageIndex);
        response.put("tableData",jdbcTemplate.queryForList(sql.toString(),params.toArray()));

        return response;
    }
}

```

##### StudentImpl

接口

```java
package com.lab.backend.service;
import com.lab.backend.domain.Student;
import org.springframework.stereotype.Service;
import java.util.List;
import java.util.Map;

@Service
public interface StudentService {
    int insert(Student student);

    int delete(String studentCode);

    int update(Student student);

    int updateByStudent(Student student);

    List<Map<String, Object>> getInfo();

    Map<Object, Object> query(Student student, String className, String majorName, String facultyName, int pageIndex, int pageSize);
}
```

接口实现

```java
package com.lab.backend.service.impl;

import com.lab.backend.repository.ClassDao;
import com.lab.backend.domain.Student;
import com.lab.backend.repository.StudentDao;
import com.lab.backend.service.StudentService;
import com.lab.backend.utils.SecurityUtil;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;
import java.util.List;
import java.util.Map;

@Service
public class StudentServiceImpl implements StudentService {

    @Resource
    private StudentDao studentDao;
    @Resource
    private ClassDao classDao;

    /**
     * 插入
     * @param student 学生实体
     * @return 执行结果
     */
    @Override
    public int insert(Student student) {
        int num=studentDao.getByID(student.getStudentID()).size();
        System.out.println(student.getStudentID());
        System.out.println(student.getClassCode());
        int classNum=classDao.getByCode(student.getClassCode()).size();
        if(num==0){
            if(classNum!=0){
                studentDao.insert(student);
                return 0;//成功插入
            }
            else{
                return 1;//班级不存在，无法插入
            }
        }
        else {
            return 2;//当前学生已存在，无法插入
        }
    }
    /**
     * 删除
     * @param studentCode 学生代码
     * @return int 0成功,1失败
     */
    @Override
    public int delete(String studentCode) {
        int num=studentDao.getByID(studentCode).size();
        if(num!=0) {
            studentDao.delete(studentCode);
            return 0;
        }
        else {
            return 1;//学生不存在，无法删除
        }
    }
    /**
     * 更新
     * @param student 学生实体
     * @return int 0成功,1失败
     */
    @Override
    public int update(Student student) {
        int num=studentDao.getByID(student.getStudentID()).size();
        int classNum=classDao.getByCode(student.getClassCode()).size();
        if(num!=0){
            if(classNum!=0){
                studentDao.update(student);
                return 0;//成功更新
            }
            else{
                return 1;//班级不存在，无法更新
            }
        }
        else {
            return 2;//当前学生不存在，无法更新
        }
    }

    /**
     * 更新
     * @param student 学生实体
     * @return int 0成功,1失败
     */
    @Override
    public int updateByStudent(Student student) {
        student.setStudentID(SecurityUtil.getUserName());
        int num=studentDao.getByID(student.getStudentID()).size();
        if(num!=0){
                studentDao.updateByStudent(student);
                return 0;//成功更新
        }
        else {
            return 1;//当前学生不存在，无法更新
        }
    }
    /**
     * 按code查询
     * @return result info
     */
    @Override
    public List<Map<String, Object>> getInfo(){
        return studentDao.getByID(SecurityUtil.getUserName());
    }

    /**
     * 多条件查询
     * @param student 学生实体
     * @return result list
     */
    @Override
    public Map<Object, Object> query(Student student, String className, String majorName, String facultyName, int pageIndex, int pageSize){
            return studentDao.query(student,className,majorName,facultyName,pageIndex,pageSize);
    }

}
```

##### StudentController

```java
package com.lab.backend.controller;

import com.lab.backend.domain.Student;

import com.lab.backend.service.AdminService;
import com.lab.backend.service.StudentService;
import com.lab.backend.utils.Result;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;
import javax.annotation.Resource;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/student")
public class StudentController {
    @Resource
    private StudentService studentService;
    @Resource
    private AdminService adminService;

    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/insert")
    public Result<Student> insertController(@RequestBody Student student){
        int r=studentService.insert(student);
        if(r==0){
            adminService.studentRegister(student.getStudentID(),"123456");
            return Result.success(student);
        }
        else if(r==1){
            return Result.error("1","班级不存在，无法插入！");
        }
        else{
            return Result.error("1","当前记录已存在，插入失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/update")
    public Result<Student> updateController(@RequestBody Student student){
        int r=studentService.update(student);
        if(r==0){
            return Result.success(student);
        }
        else if(r==1){
            return Result.error("1","班级不存在，无法更新！");
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }


    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/delete")
    public Result<String> deleteController(@RequestParam String studentID){
        int r=studentService.delete(studentID);
        if(r==0){
            return Result.success(studentID);
        }
        else{
            return Result.error("1","当前记录不存在，删除失败！");
        }
    }
    @PreAuthorize("hasRole('ADMIN')")
    @PostMapping("/query")
    public Result<Map<Object, Object>> queryController(@RequestBody Student student,String className,String majorName,String facultyName,@RequestParam int pageIndex,@RequestParam int pageSize){
        Map<Object, Object> response =studentService.query(student,className,majorName,facultyName,pageIndex,pageSize);
        if((int)response.get("total")!=0){
            return Result.success(response,"查询成功");
        }else{
            return Result.error("1","查询结果为空");
        }
    }

    @PreAuthorize("hasRole('STUDENT')")
    @PostMapping("/info")
    public Result<List<Map<String, Object>>> infoController() {
        List<Map<String, Object>> response = studentService.getInfo();
        return Result.success(response, "查看成功！");
    }

    @PreAuthorize("hasRole('STUDENT')")
    @PostMapping("/updateByStudent")
    public Result<Student> updateByStudentController(@RequestBody Student student){
        int r=studentService.updateByStudent(student);
        if(r==0){
            return Result.success(student);
        }
        else{
            return Result.error("1","当前记录不存在，无法更新！");
        }
    }
}

```

### 3.3 教师管理

#### 3.3.1 教师信息管理

#### 3.3.2 教师授课管理

### 3.4 课程管理

#### 3.4.1 课程信息管理

#### 3.4.2 学生选课管理

## 

## 4.管理员端功能分析

### 4.1 登陆认证

### 4.2 校建管理

#### 4.2.1 院系管理

##### 插入

post http://localhost:8081/faculty/insert

请求格式：

```json
{
    "facultyName": "环境工程学院",  		//not null
    "facultyCode": "0003",				//not null
    "facultyAddress": "湖南大学环境院",
    "facultyTeleno": "8801xxx"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "facultyName": "环境工程学院",
        "facultyCode": "0003",
        "facultyAddress": "湖南大学环境院",
        "facultyTeleno": "8801xxx"
    }
}
//失败
{
    "code": "1",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/faculty/update

请求格式：

```json
{
    "facultyName": "土木工程学院",			//not null
    "facultyCode": "0002",					//not null
    "facultyAddress": "湖南大学土木院x",	
    "facultyTeleno": "88010003"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "facultyName": "土木工程学院",
        "facultyCode": "0002",
        "facultyAddress": "湖南大学土木院x",
        "facultyTeleno": "88010003"
    }
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
```

##### 删除

post http://localhost:8081/faculty/delete?facultyCode=0003

请求格式：

```json

```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "0002"
}
//失败
{
    "code": "1",
    "message": "没有所要删除的课程，删除失败！",
    "data": null
}
```

##### 多条件查询

post http://localhost:8081/faculty/query?pageIndex=1&pageSize=2

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "params":
    {
        "pageIndex": 1,
        "pageSize":2
    }
    "body":
    {
        "facultyName":"信息",
        "facultyCode": null,
        "facultyAddress": null,
        "facultyTeleno": null
	}
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "facultyName": "信息科学与工程学院",
                "facultyCode": "0001",
                "facultyAddress": "湖南大学信科院",
                "facultyTeleno": "8801002"
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 4.2.2 专业管理

##### 插入

post http://localhost:8081/major/insert

请求格式：

```json
{
    "majorName": "计算机科学与技术",    //not null
    "majorCode": "080901",			 //not null
    "facultyCode": "0001",			 //not null
    "degreeLevel": "本科",			//not null
    "graduationCredits":"60"		  //not null
}
{
    "majorName": "信息安全",
    "majorCode": "080904",
    "facultyCode": "0001",
    "degreeLevel": "本科",
    "graduationCredits":"61"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "majorName": "计算机科学与技术",
        "majorCode": "080901",
        "facultyCode": "0001",
        "degreeLevel": "本科",
        "graduationCredits": "60"
    }
}
//失败
{
    "code": "1",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
{
    "code": "1",
    "message": "院系不存在，无法插入！",
    "data": null
}
```

##### 更新

post http://localhost:8081/major/update

请求格式：

```json
{
    "majorName": "计算机科学与技术",
    "majorCode": "080901",
    "facultyCode": "0001",
    "degreeLevel": "本科",
    "graduationCredits":"71"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "majorName": "计算机科学与技术",
        "majorCode": "080901",
        "facultyCode": "0001",
        "degreeLevel": "本科",
        "graduationCredits": "71"
    }
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
{
    "code": "1",
    "message": "院系不存在，无法更新！",
    "data": null
}
```



##### 删除

post http://localhost:8081/major/delete?majorCode=080901

请求格式：

```json
{
    "params":
    {
        "majorCode": "080901",
    }
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "080901"
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，删除失败！",
    "data": null
}
```

##### 多条件查询

post http://localhost:8081/major/query?facultyName=信息科学与工程学院&pageIndex=1&pageSize=2

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "params":
    {
        "facultyName": "信息科学与工程学院",
        "pageIndex": 1,
        "pageSize":2
    }
    "body":
    {
        "majorName": null,
        "majorCode": "",
        "facultyCode": "0001",
        "degreeLevel": "本科",
        "graduationCredits":""
	}
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 2,
        "pageIndex": 1,
        "tableData": [
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080901",
                "majorName": "计算机科学与技术",
                "degreeLevel": "本科",
                "graduationCredits": "61"
            },
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080904",
                "majorName": "信息安全",
                "degreeLevel": "本科",
                "graduationCredits": "61"
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 4.2.3 班级管理

##### 插入

post http://localhost:8081/class/insert

请求格式：

```json
{
    "className": "信安1901",
    "classCode": "2019080601",
    "majorCode": "080904"
}

{
    "className": "计科1901",
    "classCode": "2019080401",
    "majorCode": "080904"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "className": "计科1901",
        "classCode": "2019080401",
        "majorCode": "080904"
    }
}
//失败
{
    "code": "1",
    "message": "对应专业不存在，无法插入！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/class/update

请求格式：

```json
{
    "className": "计科1901",
    "classCode": "2019080401",
    "majorCode": "080904"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "className": "计科1901",
        "classCode": "2019080401",
        "majorCode": "080904"
    }
}
//失败
{
    "code": "1",
    "message": "对应专业不存在，无法更新！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
```



##### 删除

post http://localhost:8081/class/delete?classCode=2019080601

请求格式：

```json
{
    "params":
    {
        "classCode": "2019080601",
    }
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "计科1901"
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，删除失败！",
    "data": null
}
```

##### 多条件查询

post http://localhost:8081/class/query?majorName=信息安全&facultyName=信息科学与工程学院&pageIndex=1&pageSize=30

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "params":
    {
        "majorName": "信息安全",
        "facultyName": "信息科学与工程学院",
        "pageIndex": 1,
        "pageSize":2
    }
    "body":
    {
        "className": "",
        "classCode": "2019080601",
        "majorCode": "080904"
	}
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 2,
        "pageIndex": 1,
        "tableData": [
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080904",
                "majorName": "信息安全",
                "classCode": "2019080401",
                "className": "计科1901"
            },
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080904",
                "majorName": "信息安全",
                "classCode": "2019080601",
                "className": "信安1901"
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 4.2.4 学生管理

##### 插入

post http://localhost:8081/student/insert

请求格式：

```json
{
    "studentName": "小王",		//not null
    "studentID": "02",			 //not null
    "classCode": "2019080601",		//not null
    "identifier": "33068120010103050690",
    "dormitory": "天马学生公寓",
    "address": "湖南大写天马学生公寓三区506",
    "teleno": "13534348989",
    "birthday": "2001-01-03",
    "sex": "男",
    "grade": "19",
    "completedCredits": 23
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "studentName": "小王",
        "studentID": "02",
        "classCode": "2019080601",
        "identifier": "33068120010103050690",
        "dormitory": "天马学生公寓",
        "address": "湖南大写天马学生公寓三区506",
        "teleno": "13534348989",
        "birthday": "2001-01-03",
        "sex": "男",
        "grade": "19",
        "completedCredits": "23"
    }
}
//失败
{
    "code": "1",
    "message": "班级不存在，无法插入！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/student/update

请求格式：

```json
{
    "studentName": "小王",
    "studentID": "02",
    "classCode": "2019080601",
    "identifier": "33068120010103050690",
    "dormitory": "天马学生公寓",
    "address": "湖南大写天马学生公寓三区506",
    "teleno": "13534348989",
    "birthday": "2001-01-04",
    "sex": "男",
    "grade": "19",
    "completedCredits": 23
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "studentName": "小王",
        "studentID": "02",
        "classCode": "2019080601",
        "identifier": "33068120010103050690",
        "dormitory": "天马学生公寓",
        "address": "湖南大写天马学生公寓三区506",
        "teleno": "13534348989",
        "birthday": "2001-01-04",
        "sex": "男",
        "grade": "19",
        "completedCredits": "23"
    }
}
//失败
{
    "code": "1",
    "message": "班级不存在，无法更新！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
```

##### 删除

post http://localhost:8081/student/delete?studentID=021

请求格式：

```json
{
    "params":{
        "studentID": "02",
    }
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "02"
}
//失败
{
    "code": "1",
    "message": "当前记录不存在，删除失败！",
    "data": null
}
```

##### 多条件查询

post http://localhost:8081/student/query?className=&majorName=信息&facultyName&pageIndex=1&pageSize=30

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "params":
    {
        "className": "计科1902",
        "majorName": "信息安全",
        "facultyName": "信息科学与工程学院",
        "pageIndex": 1,
        "pageSize":2
    }
    {
        "studentName":  null,
        "studentID": null,
        "classCode": "2019080601",
        "identifier": null,
        "dormitory": "天马学生公寓",
        "address": "湖南大写天马学生公寓三区506",
        "teleno": "13534348989",
        "birthday": "2001-01-03",
        "sex": "男",
        "grade": "19",
        "completedCredits":  null
    }
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 38,
        "pageIndex": 1,
        "tableData": [
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080901",
                "majorName": "计算机科学与技术",
                "classCode": "2019080402",
                "className": "计科1902",
                "studentName": "计科2班小王",
                "studentID": "01",
                "identifier": "33068120010103050690",
                "dormitory": "天马学生公寓",
                "address": "湖南大写天马学生公寓三区506",
                "teleno": "13534348989",
                "birthday": "2001-01-03",
                "sex": "男",
                "grade": "19",
                "completedCredits": 23
            },
            {
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院",
                "majorCode": "080904",
                "majorName": "信息安全",
                "classCode": "2019080601",
                "className": "信安1901",
                "studentName": "小王1",
                "studentID": "02",
                "identifier": "33068120010103050690",
                "dormitory": "天马学生公寓",
                "address": "湖南大写天马学生公寓三区506",
                "teleno": "13534348989",
                "birthday": "2001-01-03",
                "sex": "男",
                "grade": "19",
                "completedCredits": 23
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

### 4.3 教师管理

#### 4.3.1 教师授课管理

##### 插入

post http://localhost:8081/courseClass/insert

请求格式：

```json
{
    "courseClassID": "01001",
    "courseID": "1",
    "teacherID": "0001",
    "courseClassTime": "",
    "courseClassAddress": null,
    "courseClassWeek": ""
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "courseID": "1",
        "teacherID": "0001",
        "courseClassTime": null,
        "courseClassAddress": null,
        "courseClassWeek": null
    }
}

//对应课程不存在，插入失败
{
    "code": "1",
    "message": "对应课程不存在，插入失败！",
    "data": null
}
//对应教师不存在，插入失败
{
    "code": "2",
    "message": "对应教师不存在，插入失败！",
    "data": null
}
//当前记录已存在，插入失败
{
    "code": "3",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/courseClass/update

请求格式：

```json
{
    "courseClassID": "01001",
    "courseID": "1",
    "teacherID": "0001",
    "courseClassTime": null,
    "courseClassAddress": "综401",
    "courseClassWeek": null
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "courseID": "1",
        "teacherID": "0001",
        "courseClassTime": null,
        "courseClassAddress": "综401",
        "courseClassWeek": null
    }
}
//对应课程不存在，更新失败
{
    "code": "1",
    "message": "对应课程不存在，更新失败！",
    "data": null
}
//对应教师不存在，更新失败
{
    "code": "2",
    "message": "对应教师不存在，更新失败！",
    "data": null
}
//当前记录不存在，更新失败
{
    "code": "3",
    "message": "当前记录不存在，更新失败！",
    "data": null
}

```

##### 删除

post http://localhost:8081/courseClass/delete

请求格式：

```
?courseClassID=01001
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "01001"
}

//对应学生选课非空，删除失败
{
    "code": "1",
    "message": "对应学生选课非空，删除失败！",
    "data": null
}
//该课程班级不存在，删除失败
{
    "code": "2",
    "message": "该课程班级不存在，删除失败！",
    "data": null
}
```



##### 查询

post http://localhost:8081/courseClass/query

- 不设条件的为null

请求格式1：全部查询

```json
?pageIndex=1&pageSize=2
```

```json
{
    "courseClassID": null,
    "courseID": null,
    "courseName": null,
    "teacherID": null,
    "teacherName": null,
    "facultyName": null,
    "courseClassTime": null,
    "courseClassAddress": null,
    "courseClassWeek": null,
    "courseNature": null,
    "courseCategory": null,
    "courseHours": null,
    "credit": null
}
```

返回格式1：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 2,
        "pageIndex": 1,
        "tableData": [
            {
                "courseClassID": "01001",
                "courseID": "1",
                "courseName": "数据库",
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyName": "信息科学与工程学院",
                "courseClassTime": null,
                "courseClassAddress": null,
                "courseClassWeek": null,
                "courseNature": "必修",
                "courseCategory": "专业核心",
                "courseHours": 32,
                "credit": 2
            },
            {
                "courseClassID": "01002",
                "courseID": "1",
                "courseName": "数据库",
                "teacherID": "0002",
                "teacherName": "李四",
                "facultyName": "信息科学与工程学院",
                "courseClassTime": null,
                "courseClassAddress": null,
                "courseClassWeek": null,
                "courseNature": "必修",
                "courseCategory": "专业核心",
                "courseHours": 32,
                "credit": 2
            }
        ]
    }
}
```

请求格式2：设有条件

```
?pageIndex=1&pageSize=2
```

```json
{
    "courseClassID": "01001",
    "courseID": null,
    "courseName": "数据库",
    "teacherID": null,
    "teacherName": null,
    "facultyName": "信息科学与工程学院",
    "courseClassTime": null,
    "courseClassAddress": null,
    "courseClassWeek": null,
    "courseNature": "必修",
    "courseCategory": "专业核心",
    "courseHours": 32,
    "credit": 2
}
```

返回格式2：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseClassID": "01001",
                "courseID": "1",
                "courseName": "数据库",
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyName": "信息科学与工程学院",
                "courseClassTime": null,
                "courseClassAddress": null,
                "courseClassWeek": null,
                "courseNature": "必修",
                "courseCategory": "专业核心",
                "courseHours": 32,
                "credit": 2
            }
        ]
    }
}
```

#### 4.3.2 录入教师管理

##### 插入

post http://localhost:8081/teacher/insert

请求格式：

```json
{
    "teacherName":"张三",
    "teacherID":"0001",
    "facultyCode":"1"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "teacherName": "张三",
        "teacherID": "0001",
        "facultyCode": "1"
    }
}

//失败：对应院系不存在
{
    "code": "1",
    "message": "对应院系不存在，插入失败！",
    "data": null
}

//失败：当前记录已存在
{
    "code": "2",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 更新

post http://localhost:8081/teacher/update

请求格式：

```json
{
    "teacherName":"李四",
    "teacherID":"0001",
    "facultyCode":"1"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "teacherName": "李四",
        "teacherID": "0001",
        "facultyCode": "1"
    }
}

//失败：对应院系不存在
{
    "code": "1",
    "message": "对应院系不存在，插入失败！",
    "data": null
}

//失败：当前记录已存在
{
    "code": "2",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

##### 删除（按ID）

post http://localhost:8081/teacher/delete?teacherID=0001

请求格式：

```
?teacherID=0001
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "0001"
}

//失败：对应课程班级非空
{
    "code": "1",
    "message": "对应课程班级非空，删除失败！",
    "data": null
}

//失败：当前教师不存在
{
    "code": "2",
    "message": "当前教师不存在，删除失败！",
    "data": null
}
```

##### 查询

post http://localhost:8081/teacher/query

- 不设条件的为null

请求格式1：全部查询

```
?pageIndex=1&pageSize=2
```

```json
{
    "teacherName": null,
    "teacherID": null,
    "facultyCode": null,
    "facultyName": null
}
```

返回格式1：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 2,
        "pageIndex": 1,
        "tableData": [
            {
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院"
            },
            {
                "teacherID": "0002",
                "teacherName": "李四",
                "facultyCode": "0002",
                "facultyName": "土木工程学院"
            }
        ]
    }
}
```

请求格式2：设有条件

```
?pageIndex=1&pageSize=2
```

```json
{
    "teacherName":null,
    "teacherID":"0001",
    "facultyCode":"0001"
    "facultyName": null
}
```

返回格式2：

```json
//查询成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "teacherID": "0001",
                "teacherName": "李四",
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院"
            }
        ]
    }
}
//查询失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

### 4.4 课程管理

#### 4.3.1 课程信息管理

##### 插入

`post http://localhost:8081/course/insert`

请求格式：

```json
{
    "courseName": "数据库",
    "courseNature": "必修",
    "courseCategory": "专业课",
    "courseID": "0001",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
{
    "courseName": "计网",
    "courseNature": "必修",
    "courseCategory": "专业课",
    "courseID": "0002",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseName": "数据库",
        "courseNature": "必修",
        "courseCategory": "专业课",
        "courseID": "0002",
        "facultyCode": "0001",
        "courseHours": 25,
        "credit": 2
    }
}
{
    "code": "2",
    "message": "该课程已存在，插入失败！",
    "data": null
}
```

##### 更新

`post http://127.0.0.1:8081/course/update`

请求格式：

```json
{
    "courseName": "数据库",
    "courseNature": "必修2",
    "courseCategory": "专业课",
    "courseID": "0002",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseName": "数据库",
        "courseNature": "必修2",
        "courseCategory": "专业课",
        "courseID": "0002",
        "facultyCode": "0001",
        "courseHours": 25,
        "credit": 2
    }
}
//失败
{
    "code": "2",
    "message": "该课程不存在，更新失败！",
    "data": null
}
```

##### 删除

`post http://127.0.0.1:8081/course/delete?courseID=0002`

请求格式：

```json
{
    "facultyName": "信息科学与工程学院",
    "facultyCode": "0001",
    "facultyAddress": "湖南大学信科院",
    "facultyTeleno": "8801002"
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "0002"
}
//失败
{
    "code": "1",
    "message": "没有所要删除的课程，删除失败！",
    "data": null
}
```

##### 多条件查询

`post http://localhost:8081/course/query?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "courseName": "数据库",
    "courseNature": "必修",
    "courseCategory": "专业课",
    "courseID": "0002",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseName": "数据库",
                "courseNature": "必修",
                "courseCategory": "专业课",
                "courseID": "0002",
                "facultyCode": "0001",
                "courseHours": 25,
                "credit": 2
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 4.3.2 选修信息管理

##### 插入

`post http://127.0.0.1:8081/studentcourse/insert`

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "01",
    "score": 98
}
{
    "courseClassID": "01001",
    "studentID": "02",
    "score": 94
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "studentID": "01",
        "score": 98
    }
}
{
    "code": "2",
    "message": "没有课程班级，插入失败！",
    "data": null
}
```

##### 更新

`post http://localhost:8081/studentcourse/update`

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "01",
    "score": 95
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "studentID": "01",
        "score": 95
    }
}
{
    "code": "2",
    "message": "没有课程班级，更新失败！",
    "data": null
}
```

##### 删除

`post 127.0.0.1:8081/studentcourse/delete?courseClassID=01001&&studentID=01`

请求格式：

```json
?courseClassID=01001
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": "01001 01"
}
{
    "code": "1",
    "message": "没有找到要删除的记录，删除失败！",
    "data": null
}
```

##### 多条件查询

`post http://127.0.0.1:8081/studentcourse/query?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "02",
    "studentName": "小王",
    "score": 95,
    "courseName": "数据库"
}
```

返回格式：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseClassID": "01001",
                "studentID": "02",
                "studentName": "小王",
                "score": 95,
                "courseName": "数据库"
            }
        ]
    }
}
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

## 5.学生端功能分析

### 5.1 校园信息查询

#### 5.1.1 院系查询

同管理端查询接口

#### 5.1.2 专业查询

同管理端查询接口

#### 5.1.3 班级查询

同管理端查询接口

### 5.2 个人信息管理

#### 5.2.1 信息查询

查询自己的信息

post http://localhost:8081/student/info

```json
//成功
{
    "code": "0",
    "message": "查看成功！",
    "data": [
        {
            "facultyName": "信息科学与工程学院",
            "facultyCode": "0001",
            "majorName": "计算机科学与技术",
            "majorCode": "080901",
            "className": "计科1902",
            "classCode": "2019080402",
            "studentName": "计科2班小王",
            "studentID": "01",
            "identifier": "33068120010103050690",
            "dormitory": "天马学生公寓",
            "address": "湖南大写天马学生公寓三区506",
            "teleno": "13534348989",
            "birthday": "2001-01-03",
            "sex": "男",
            "grade": "19",
            "completedCredits": 23
        }
    ]
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 5.2.2 更新信息

post http://localhost:8081/student/updateByStudent

请求格式

```
{
    "studentName": "小王",
    "studentID": "02",
    "classCode": "2019080601",
    "identifier": "33068120010103050690",
    "dormitory": "天马学生公寓",
    "address": "湖南大写天马学生公寓三区506",
    "teleno": "13534348989",
    "birthday": "2001-01-03",
    "sex": "男",
    "grade": "19",
    "completedCredits": 23
}
```

但是学生只能更新可以修改的信息，且不能更新别人的信息

后端已经默认认为studentName，studentID，completedCredits，classCode都不能修改，即使提供了但是也不会更新。

返回格式：

```
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "studentName": "小王",
        "studentID": "02",
        "classCode": "2019080601",
        "identifier": "33068120010103050690",
        "dormitory": "天马学生公寓",
        "address": "湖南大写天马学生公寓三区506",
        "teleno": "13534348989",
        "birthday": "2001-01-04",
        "sex": "男",
        "grade": "19",
        "completedCredits": "23"
    }
}
//失败
{
    "code": "1",
    "message": "班级不存在，无法更新！",
    "data": null
}
{
    "code": "1",
    "message": "当前记录不存在，无法更新！",
    "data": null
}
```

### 5.3 课程信息查询

#### 5.3.1 查询可选课程

相比于管理员的该接口，查询条件和结果**都少了“TeacherID”属性**

post http://localhost:8081/courseClass/queryByUser

#### 5.3.2 教师信息查询

无法得到其它教师的ID

post http://localhost:8081/teacher/queryWithoutID

请求格式：

```
?pageIndex=1&pageSize=2
```

```json
{
    "teacherName":null,
    "facultyCode":"0001",
    "facultyName": null
}
```

返回格式:

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "teacherName": "李四",
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院"
            }
        ]
    }
}
```

#### 5.4.3 课程信息多条件查询

`post http://localhost:8081/faculty/query?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "courseName": "数据库",
    "courseNature": "必修",
    "courseCategory": "专业课",
    "courseID": "0002",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseName": "数据库",
                "courseNature": "必修",
                "courseCategory": "专业课",
                "courseID": "0002",
                "facultyCode": "0001",
                "courseHours": 25,
                "credit": 2
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

### 5.4 学生选课

#### 5.4.1 插入

`post http://127.0.0.1:8081/studentcourse/insertByStudent?courseClassID=01001`

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "01",
    "score": 98
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": "01001 01"
}
{
    "code": "2",
    "message": "没有课程班级，插入失败！",
    "data": null
}
```

#### 5.4.2 删除

`post 127.0.0.1:8081/studentcourse/deleteByStudent?courseClassID=01001`

请求格式：

```json
?courseClassID=01001
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": "01001 01"
}
{
    "code": "2",
    "message": "没有课程班级，插入失败！",
    "data": null
}
```

#### 5.4.3 多条件选课信息查询

（只能查自己）

`post http://127.0.0.1:8081/studentcourse/queryByStudent?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "courseClassID": "01001",
    "studentName": "小张",
    "score": 0,
    "courseName": "数据库"
}
```

返回格式：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseClassID": "01001",
                "studentID": "01",
                "studentName": "小张",
                "score": 0,
                "courseName": "数据库"
            }
        ]
    }
}
```

## 6.教师端功能分析

### 6.1 校园信息查询

#### 6.1.1 院系查询

同管理端查询接口

#### 6.1.2 专业查询

同管理端查询接口

#### 6.1.2 班级查询

同管理查询接口

### 6.2 个人信息管理

#### 6.2.1 教师公共信息查询

无法得到其它教师的ID

post http://localhost:8081/teacher/queryWithoutID

请求格式：

```
?pageIndex=1&pageSize=2
```

```json
{
    "teacherName":null,
    "facultyCode":"0001",
    "facultyName": null
}
```

返回格式:

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "teacherName": "李四",
                "facultyCode": "0001",
                "facultyName": "信息科学与工程学院"
            }
        ]
    }
}
```



#### 6.2.2 得到自己的信息

post http://localhost:8081/teacher/info

返回格式：

```JSON
{
    "code": "0",
    "message": "查看成功！",
    "data": [
        {
            "teacherID": "0001",
            "teacherName": "李四",
            "facultyCode": "0001",
            "facultyName": "信息科学与工程学院"
        }
    ]
}
```

### 6.3 教师授课管理

#### 6.3.1 插入

post http://localhost:8081/courseClass/insertByTeacher

请求格式：

- teacherID固定为null（教师插入课程，表示教师自身开课）

```json
{
    "courseClassID": "01001",
    "courseID": "1",
    "teacherID": null,
    "courseClassTime": "",
    "courseClassAddress": null,
    "courseClassWeek": ""
}
```

返回格式

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01003",
        "courseID": "1",
        "teacherID": "0001",
        "courseClassTime": "",
        "courseClassAddress": null,
        "courseClassWeek": ""
    }
}

//对应课程不存在，插入失败
{
    "code": "1",
    "message": "对应课程不存在，插入失败！",
    "data": null
}
//当前记录已存在，插入失败
{
    "code": "2",
    "message": "当前记录已存在，插入失败！",
    "data": null
}
```

#### 6.3.2 更新

post http://localhost:8081/courseClass/updateByTeacher

请求格式：

- teacherID固定为null（教师只能更新自己的课程）

```json
{
    "courseClassID": "01003",
    "courseID": "1",
    "teacherID": null,
    "courseClassTime": "一(1,2)",
    "courseClassAddress": null,
    "courseClassWeek": ""
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01003",
        "courseID": "1",
        "teacherID": "0001",
        "courseClassTime": "一(1,2)",
        "courseClassAddress": null,
        "courseClassWeek": ""
    }
}

//对应课程不存在，更新失败
{
    "code": "1",
    "message": "对应课程不存在，更新失败！",
    "data": null
}
//当前记录不存在，更新失败
{
    "code": "2",
    "message": "当前记录不存在，更新失败！",
    "data": null
}
```

#### 6.3.3 删除

post http://localhost:8081/courseClass/deleteByTeacher?courseClassID=01001

请求格式：

```json
?courseClassID=01001
```

返回格式:

```json
//成功
{
    "code": "0",
    "message": "成功",
    "data": "01001"
}

//对应学生选课非空，删除失败
{
    "code": "1",
    "message": "对应学生选课非空，删除失败！",
    "data": null
}
//该课程班级不存在，删除失败
{
    "code": "2",
    "message": "该课程班级不存在，删除失败！",
    "data": null
}
//该课程不是你开的
{
    "code": "3",
    "message": "该课程不是你开的！",
    "data": null
}
```

#### 6.3.4 查询（用于查看开课信息）

相比于管理员的该接口，查询条件和结果**都少了“TeacherID”属性**

post http://localhost:8081/courseClass/queryByUser

#### 6.3.5 查询自己的授课信息



### 6.4 课程信息管理

#### 6.4.1 课程信息查询

`post http://localhost:8081/course/query?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "courseName": "数据库",
    "courseNature": "必修",
    "courseCategory": "专业课",
    "courseID": "0002",
    "facultyCode": "0001",
    "courseHours": 25,
    "credit": 2
}
```

返回格式：

```json
//成功
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseName": "数据库",
                "courseNature": "必修",
                "courseCategory": "专业课",
                "courseID": "0002",
                "facultyCode": "0001",
                "courseHours": 25,
                "credit": 2
            }
        ]
    }
}
//失败
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```

#### 6.4.2 学生成绩更新

`post http://localhost:8081/studentcourse/updateByTeacher`

请求格式：

```json
{
    "courseClassID": "01001",
    "studentID": "01",
    "score": 95
}
{
    "courseClassID": "01001",
    "studentID": "02",
    "score": 95
}
```

返回格式：

```json
{
    "code": "0",
    "message": "成功",
    "data": {
        "courseClassID": "01001",
        "studentID": "02",
        "score": 95
    }
}
{
    "code": "1",
    "message": "没有找到对应的选课，更新失败！",
    "data": null
}
```



#### 6.4.3 学生成绩查询

`post http://127.0.0.1:8081/studentcourse/queryByTeacher?pageIndex=1&pageSize=2`

```c
//全空即全部查询,
//null和"  "、""等效
```

请求格式：

```json
{
    "courseClassID": "01001",
    "courseName": "数据库",
    "studentID": "02",
    "studentName": "小王",
    "score": 95
}
```

返回格式：

```json
{
    "code": "0",
    "message": "查询成功",
    "data": {
        "total": 1,
        "pageIndex": 1,
        "tableData": [
            {
                "courseClassID": "01001",
                "courseName": "数据库",
                "studentID": "02",
                "studentName": "小王",
                "score": 95
            }
        ]
    }
}
{
    "code": "1",
    "message": "查询结果为空",
    "data": null
}
```



# 四、界面设计

## 1.环境要求

## 2.项目整体架构



## 3.管理员端

## 4.学生端

## 5.教师端

# 五、项目使用说明

